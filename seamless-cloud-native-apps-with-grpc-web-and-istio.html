<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Seamless Cloud-Native Apps with gRPC-Web and Istio</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Service mesh, distributed systems, software design, and more..." />
    <link rel="shortcut icon" href="https://venilnoronha.io/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Venil Noronha" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Seamless Cloud-Native Apps with gRPC-Web and Istio" />
    <meta property="og:description" content="gRPC-Web enables web applications to access gRPC backends via a proxy like Envoy. Envoy serves as the default proxy for Istio, and, so, we can leverage Istio’s EnvoyFilter construct to create seamless, well connected, Cloud-Native web applications. &nbsp;&nbsp; Introduction In this post, I’ll walk you through the process of building" />
    <meta property="og:url" content="https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio" />
    <meta property="og:image" content="https://venilnoronha.io/assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/banner.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/false" />
    <meta property="article:author" content="https://www.facebook.com/false" />
    <meta property="article:published_time" content="2018-11-10T15:48:00+00:00" />
    <meta property="article:modified_time" content="2018-11-10T15:48:00+00:00" />
    <meta property="article:tag" content="Distributed Systems" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Seamless Cloud-Native Apps with gRPC-Web and Istio" />
    <meta name="twitter:description" content="gRPC-Web enables web applications to access gRPC backends via a proxy like Envoy. Envoy serves as the default proxy for Istio, and, so, we can leverage Istio’s EnvoyFilter construct to create seamless, well connected, Cloud-Native web applications. &nbsp;&nbsp; Introduction In this post, I’ll walk you through the process of building" />
    <meta name="twitter:url" content="https://venilnoronha.io/" />
    <meta name="twitter:image" content="https://venilnoronha.io/assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/banner.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Venil Noronha" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Distributed Systems" />
    <meta name="twitter:site" content="@venilnoronha" />
    <meta name="twitter:creator" content="@venilnoronha" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Venil Noronha",
        "logo": "https://venilnoronha.io/false"
    },
    "url": "https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio",
    "image": {
        "@type": "ImageObject",
        "url": "https://venilnoronha.io/assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/banner.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio"
    },
    "description": "gRPC-Web enables web applications to access gRPC backends via a proxy like Envoy. Envoy serves as the default proxy for Istio, and, so, we can leverage Istio’s EnvoyFilter construct to create seamless, well connected, Cloud-Native web applications. &nbsp;&nbsp; Introduction In this post, I’ll walk you through the process of building"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Seamless Cloud-Native Apps with gRPC-Web and Istio" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://venilnoronha.io/">Venil Noronha</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-talks" role="menuitem"><a href="/talks/">Talks</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-feed" role="menuitem"><a href="https://venilnoronha.io/feed.xml">Feed</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link" href="https://github.com/venilnoronha" target="_blank" rel="noopener"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"/></svg>
</a>
            
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/venilnoronha" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
            
            
                <a class="social-link" href="https://linkedin.com/in/venilnoronha" target="_blank" rel="noopener"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M365 1414h231v-694h-231v694zm246-908q-1-52-36-86t-93-34-94.5 34-36.5 86q0 51 35.5 85.5t92.5 34.5h1q59 0 95-34.5t36-85.5zm585 908h231v-398q0-154-73-233t-193-79q-136 0-209 117h2v-101h-231q3 66 0 694h231v-388q0-38 7-56 15-35 45-59.5t74-24.5q116 0 116 157v371zm468-998v960q0 119-84.5 203.5t-203.5 84.5h-960q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z"/></svg>
</a>
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-distributed-systems ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="10 November 2018">10 November 2018</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/distributed-systems/'>DISTRIBUTED SYSTEMS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Seamless Cloud-Native Apps with gRPC-Web and Istio</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/banner.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><a href="https://github.com/grpc/grpc-web">gRPC-Web</a> enables web applications to access
<a href="https://grpc.io/">gRPC</a> backends via a proxy like <a href="https://www.envoyproxy.io/">Envoy</a>.
Envoy serves as the default proxy for <a href="https://istio.io/">Istio</a>, and, so, we
can leverage Istio’s <a href="https://istio.io/docs/reference/config/istio.networking.v1alpha3/#EnvoyFilter">EnvoyFilter</a>
construct to create seamless, well connected, Cloud-Native web applications.</p>

<p style="text-align: center;">
  <img src="assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/grpc-logo.svg" alt="gRPC" style="width: 250px; display: inline-block;" />
  &nbsp;&nbsp;
  <img src="assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/istio-logo.svg" alt="Istio" style="width: 150px; display: inline-block;" />
</p>

<h2 id="introduction">Introduction</h2>

<p>In this post, I’ll walk you through the process of building a simple web
application that replaces keywords in user-entered text with emojis by
communicating with a gRPC backend via gRPC-Web and Istio.</p>

<p>Below is an outline of the steps we’ll follow to create the emoji application.</p>

<ol>
  <li>Define the protocol format using <a href="https://developers.google.com/protocol-buffers/">Protobuf</a></li>
  <li>Compile the Protobuf definition to generate Go and JavaScript files</li>
  <li>Build and test a Go based gRPC service that replaces keywords in input text with emojis</li>
  <li>Create a web interface for the emoji service using gRPC-Web</li>
  <li>Configure the EnvoyFilter and deploy the backend over Istio</li>
  <li>Deploy the web application and test our emoji service</li>
</ol>

<h2 id="the-architecture">The Architecture</h2>

<p>Let’s dive a little deeper to understand what the final architecture for the
emoji service will look like.</p>

<p><img src="assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/architecture.svg" alt="Architecture" /></p>

<p>Simply put, the web application will leverage the gRPC-Web library to send HTTP
requests to the Istio Gatway whenever the user supplies some text. The Istio
Gateway will then route the HTTP request to the Proxy sidecar running alongside
the emoji service backend, which will then translate the HTTP call to a gRPC
call using Envoy’s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/grpc_web_filter">gRPC-Web</a>
filter.</p>

<h2 id="defining-the-protocol-format">Defining The Protocol Format</h2>

<p>First, let’s define the protocol format using Protobuf.</p>

<div class="language-proto highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">emoji</span><span class="p">;</span>

<span class="kd">service</span> <span class="n">EmojiService</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">Emojize</span> <span class="p">(</span><span class="n">EmojizeRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">EmojizeReply</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">EmojizeRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">text</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">EmojizeReply</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">emojized_text</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We define a simple <code class="language-plaintext highlighter-rouge">service</code> named <code class="language-plaintext highlighter-rouge">EmojiService</code> that understands a <code class="language-plaintext highlighter-rouge">rpc</code> call
named <code class="language-plaintext highlighter-rouge">Emojize</code> which accepts an <code class="language-plaintext highlighter-rouge">EmojizeRequest</code> object and returns an instance
of <code class="language-plaintext highlighter-rouge">EmojizeReply</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">message</code> named <code class="language-plaintext highlighter-rouge">EmojizeRequest</code> holds a <code class="language-plaintext highlighter-rouge">string</code> field named <code class="language-plaintext highlighter-rouge">text</code> to
represent user-entered text. Also, <code class="language-plaintext highlighter-rouge">EmojizeReply</code> holds a <code class="language-plaintext highlighter-rouge">string</code> named
<code class="language-plaintext highlighter-rouge">emojized_text</code> to represent the final output string wherein the server will
have replaced known emoji keywords with an actual emoji character.</p>

<h2 id="compiling-the-protobuf-definition">Compiling The Protobuf Definition</h2>

<p>Let’s first create the project directory structure like <code class="language-plaintext highlighter-rouge">grpc-web-emoji/emoji/</code>
and put the above definition in a file named <code class="language-plaintext highlighter-rouge">emoji.proto</code>.</p>

<p>We can now compile the <code class="language-plaintext highlighter-rouge">emoji.proto</code> file and generate the necessary Go files.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>protoc <span class="nt">-I</span> emoji/ emoji/emoji.proto <span class="nt">--go_out</span><span class="o">=</span><span class="nv">plugins</span><span class="o">=</span>grpc:emoji
</code></pre></div></div>

<p>Similarly, we also generate the JavaScript files.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>protoc <span class="nt">-I</span> emoji/ emoji/emoji.proto <span class="nt">--js_out</span><span class="o">=</span><span class="nv">import_style</span><span class="o">=</span>commonjs:emoji <span class="se">\</span>
         <span class="nt">--grpc-web_out</span><span class="o">=</span><span class="nv">import_style</span><span class="o">=</span>commonjs,mode<span class="o">=</span>grpcwebtext:emoji
</code></pre></div></div>

<p>At this point, you should land up with a directory structure like below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>── grpc-web-emoji
   └── emoji
       ├── emoji.pb.go
       ├── emoji.proto
       ├── emoji_grpc_web_pb.js
       └── emoji_pb.js
</code></pre></div></div>

<h2 id="building-and-testing-the-go-backend">Building And Testing The Go Backend</h2>

<p>Let’s now create a go program that implements the <code class="language-plaintext highlighter-rouge">EmojiService</code> API. To do so,
we create a file named <code class="language-plaintext highlighter-rouge">main.go</code> with the following contents.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"log"</span>
	<span class="s">"net"</span>

	<span class="n">proto</span> <span class="s">"github.com/venilnoronha/grpc-web-emoji/emoji"</span>
	<span class="s">"google.golang.org/grpc"</span>
	<span class="s">"google.golang.org/grpc/reflection"</span>
	<span class="n">emoji</span> <span class="s">"gopkg.in/kyokomi/emoji.v1"</span>
<span class="p">)</span>

<span class="c">// server is used to implement the EmojiService interface</span>
<span class="k">type</span> <span class="n">server</span> <span class="k">struct</span><span class="p">{}</span>

<span class="c">// Emojize takes a input string via EmojizeRequest, replaces known keywords with</span>
<span class="c">// actual emoji characters and returns it via a EmojizeReply instance.</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span> <span class="n">Emojize</span><span class="p">(</span><span class="n">c</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">proto</span><span class="o">.</span><span class="n">EmojizeRequest</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="n">proto</span><span class="o">.</span><span class="n">EmojizeReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">proto</span><span class="o">.</span><span class="n">EmojizeReply</span><span class="p">{</span><span class="n">EmojizedText</span><span class="o">:</span> <span class="n">emoji</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Text</span><span class="p">)},</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// listen to TCP requests over port 9000</span>
	<span class="n">lis</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">net</span><span class="o">.</span><span class="n">Listen</span><span class="p">(</span><span class="s">"tcp"</span><span class="p">,</span> <span class="s">":9000"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"failed to listen: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"listening on %s"</span><span class="p">,</span> <span class="n">lis</span><span class="o">.</span><span class="n">Addr</span><span class="p">())</span>

	<span class="c">// register the EmojiService implementation with the gRPC server</span>
	<span class="n">s</span> <span class="o">:=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">NewServer</span><span class="p">()</span>
	<span class="n">proto</span><span class="o">.</span><span class="n">RegisterEmojiServiceServer</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="p">{})</span>
	<span class="n">reflection</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">s</span><span class="o">.</span><span class="n">Serve</span><span class="p">(</span><span class="n">lis</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"failed to serve: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I’ve used the <a href="https://github.com/kyokomi/emoji">kyokomi/emoji</a> library to do
the heavy lifting i.e. converting keywords from input text into emojis.</p>

<p>Let’s start the server, like so:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>go run <span class="nt">-v</span> main.go
<span class="go">2018/11/12 10:45:12 listening on [::]:9000
</span></code></pre></div></div>

<p>It’s now time to test the emoji service programmatically. We’ll do so by
creating a new client implementation named <code class="language-plaintext highlighter-rouge">emoji_client.go</code> with the following
contents.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"log"</span>
	<span class="s">"time"</span>

	<span class="n">proto</span> <span class="s">"github.com/venilnoronha/grpc-web-emoji/emoji"</span>
	<span class="s">"golang.org/x/net/context"</span>
	<span class="s">"google.golang.org/grpc"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// connect to the server</span>
	<span class="n">conn</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">Dial</span><span class="p">(</span><span class="s">"localhost:9000"</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">WithInsecure</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"could not connect to the service: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="n">conn</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

	<span class="c">// send a request to the server</span>
	<span class="n">ctx</span><span class="p">,</span> <span class="n">cancel</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">WithTimeout</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
	<span class="k">defer</span> <span class="n">cancel</span><span class="p">()</span>

	<span class="n">c</span> <span class="o">:=</span> <span class="n">proto</span><span class="o">.</span><span class="n">NewEmojiServiceClient</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
	<span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">Emojize</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">proto</span><span class="o">.</span><span class="n">EmojizeRequest</span><span class="p">{</span>
		<span class="n">Text</span><span class="o">:</span> <span class="s">"I like :pizza: and :sushi:!"</span><span class="p">,</span>
	<span class="p">})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"could not call service: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"server says: %s"</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">GetEmojizedText</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can now run the emoji service client as shown below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>go run emoji_client.go
<span class="go">2018/11/12 10:55:52 server says: I like 🍕  and 🍣 !
</span></code></pre></div></div>

<p>Voila! The gRPC emoji service works as expected, and it’s now time to get the
web frontend up and running.</p>

<h2 id="creating-the-web-interface-using-grpc-web">Creating The Web Interface Using gRPC-Web</h2>

<p>First, let’s create a HTML page named <code class="language-plaintext highlighter-rouge">index.html</code>. The page displays a text
editor to the user and calls a <code class="language-plaintext highlighter-rouge">emojize</code> function (which we’ll define later) to
send the user-input to the backend emoji service. The <code class="language-plaintext highlighter-rouge">emojize</code> function will
also consume the gRPC response from the backend service and update the user
input field with the data given out by the server.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"editor"</span> <span class="na">contentEditable=</span><span class="s">"true"</span> <span class="na">hidefocus=</span><span class="s">"true"</span> <span class="na">onkeyup=</span><span class="s">"emojize()"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"dist/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Let’s put the JavaScript code for the web frontend in a file named <code class="language-plaintext highlighter-rouge">client.js</code>
as shown below.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span><span class="nx">EmojizeRequest</span><span class="p">,</span> <span class="nx">EmojizeReply</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">emoji/emoji_pb.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span><span class="nx">EmojiServiceClient</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">emoji/emoji_grpc_web_pb.js</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EmojiServiceClient</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://192.168.99.100:31380</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">editor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">editor</span><span class="dl">'</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">emojize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EmojizeRequest</span><span class="p">();</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">setText</span><span class="p">(</span><span class="nx">editor</span><span class="p">.</span><span class="nx">innerText</span><span class="p">);</span>

  <span class="nx">client</span><span class="p">.</span><span class="nx">emojize</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="p">{},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">getEmojizedText</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice that the <code class="language-plaintext highlighter-rouge">EmojiServiceClient</code> connects with the backend emoji service at
<code class="language-plaintext highlighter-rouge">http://192.168.99.100:31380</code> and not <code class="language-plaintext highlighter-rouge">http://localhost:9000</code>. This is because
the web application can’t directly speak with a gRPC backend, and, therefore,
we’ll be deploying our backend emoji service over Istio. The Istio deployment
will be running on <a href="https://kubernetes.io/docs/setup/minikube/">Minikube</a> with
the IP address of <code class="language-plaintext highlighter-rouge">192.168.99.100</code> and the default Istio Ingress port exposed
for HTTP is <code class="language-plaintext highlighter-rouge">31380</code>.</p>

<p>We’ll now need a couple of libraries to generate the final <code class="language-plaintext highlighter-rouge">dist/main.js</code> which
we reference in <code class="language-plaintext highlighter-rouge">index.html</code>. To do so, we use the following <a href="https://www.npmjs.com/">npm</a>
<code class="language-plaintext highlighter-rouge">package.json</code> configuration.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grpc-web-emoji"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.1.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gRPC-Web Emoji Sample"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@grpc/proto-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.3.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"google-protobuf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.6.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"grpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.15.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"grpc-web"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"webpack"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.16.5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"webpack-cli"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.1.0"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>At this point, we can install the libraries and generate <code class="language-plaintext highlighter-rouge">dist/main.js</code> using
the following commands.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>npm <span class="nb">install</span>
<span class="gp">$</span><span class="w"> </span>npx webpack client.js
</code></pre></div></div>

<h2 id="deploying-the-backend-over-istio">Deploying The Backend Over Istio</h2>

<p>We can now package the backend emoji service into a container and deploy it over
Istio. We’d need to install the gRPC-Web <code class="language-plaintext highlighter-rouge">EnvoyFilter</code> here so that calls to the
backend gRPC service can be translated to/from gRPC and HTTP.</p>

<p>Let’s start off by building the Docker image with the following <code class="language-plaintext highlighter-rouge">Dockerfile</code>.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> golang:1.11 as builder</span>
<span class="k">WORKDIR</span><span class="s"> /root/go/src/github.com/venilnoronha/grpc-web-emoji/</span>
<span class="k">COPY</span><span class="s"> ./ .</span>
<span class="k">RUN </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-a</span> <span class="nt">-installsuffix</span> cgo <span class="nt">-v</span> <span class="nt">-o</span> emoji-service main.go

<span class="k">FROM</span><span class="s"> scratch</span>
<span class="k">WORKDIR</span><span class="s"> /bin/</span>
<span class="k">COPY</span><span class="s"> --from=builder /root/go/src/github.com/venilnoronha/grpc-web-emoji/emoji-service .</span>
<span class="k">ENTRYPOINT</span><span class="s"> [ "/bin/emoji-service" ]</span>
<span class="k">CMD</span><span class="s"> [ "9000" ]</span>
<span class="k">EXPOSE</span><span class="s"> 9000</span>
</code></pre></div></div>

<p>We can build and push the image to Docker Hub like so:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">-t</span> vnoronha/grpc-web-emoji <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker push vnoronha/grpc-web-emoji
</code></pre></div></div>

<p>Next, we define the Kubernetes <code class="language-plaintext highlighter-rouge">Service</code> and <code class="language-plaintext highlighter-rouge">Deployment</code> configuration as shown
below. Let’s call this <code class="language-plaintext highlighter-rouge">backend.yaml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">backend</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">backend</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">grpc-port</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">9000</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">backend</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">backend</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">backend</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">backend</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">vnoronha/grpc-web-emoji</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9000</span>
</code></pre></div></div>

<p>Note that once we deploy this service over Istio, the <code class="language-plaintext highlighter-rouge">grpc-</code> prefix in the
<code class="language-plaintext highlighter-rouge">Service</code> port <code class="language-plaintext highlighter-rouge">name</code> will allow Istio to recognize this as a gRPC service.</p>

<p>Since we want the gRPC-Web filter to be installed on the <code class="language-plaintext highlighter-rouge">backend</code> sidecar
proxy, we need to install it prior to deploying the <code class="language-plaintext highlighter-rouge">backend</code> service. The
<code class="language-plaintext highlighter-rouge">EnvoyFilter</code> configuration is shown below. We name this <code class="language-plaintext highlighter-rouge">filter.yaml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">EnvoyFilter</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">grpc-web-filter</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">workloadLabels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">backend</span>
  <span class="na">filters</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">listenerMatch</span><span class="pi">:</span>
      <span class="na">listenerType</span><span class="pi">:</span> <span class="s">SIDECAR_INBOUND</span>
      <span class="na">listenerProtocol</span><span class="pi">:</span> <span class="s">HTTP</span>
    <span class="na">insertPosition</span><span class="pi">:</span>
      <span class="na">index</span><span class="pi">:</span> <span class="s">FIRST</span>
    <span class="na">filterType</span><span class="pi">:</span> <span class="s">HTTP</span>
    <span class="na">filterName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">envoy.grpc_web"</span>
    <span class="na">filterConfig</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<p>Next, we need to define an Istio <code class="language-plaintext highlighter-rouge">Gateway</code> to route HTTP traffic over to the
backend service. To do so, we write the following configuration to a file named
<code class="language-plaintext highlighter-rouge">gateway.yaml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">DestinationRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">backend</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">backend</span>
  <span class="na">subsets</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">v1</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Gateway</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">gateway</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">istio</span><span class="pi">:</span> <span class="s">ingressgateway</span>
  <span class="na">servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span>
      <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">HTTP</span>
    <span class="na">hosts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualService</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">vs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
  <span class="na">gateways</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">gateway</span>
  <span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">route</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">backend</span>
        <span class="na">port</span><span class="pi">:</span>
          <span class="na">number</span><span class="pi">:</span> <span class="m">9000</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">corsPolicy</span><span class="pi">:</span>
      <span class="na">allowOrigin</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
      <span class="na">allowMethods</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">POST</span>
        <span class="pi">-</span> <span class="s">GET</span>
        <span class="pi">-</span> <span class="s">OPTIONS</span>
        <span class="pi">-</span> <span class="s">PUT</span>
        <span class="pi">-</span> <span class="s">DELETE</span>
      <span class="na">allowHeaders</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">grpc-timeout</span>
        <span class="pi">-</span> <span class="s">content-type</span>
        <span class="pi">-</span> <span class="s">keep-alive</span>
        <span class="pi">-</span> <span class="s">user-agent</span>
        <span class="pi">-</span> <span class="s">cache-control</span>
        <span class="pi">-</span> <span class="s">content-type</span>
        <span class="pi">-</span> <span class="s">content-transfer-encoding</span>
        <span class="pi">-</span> <span class="s">custom-header-1</span>
        <span class="pi">-</span> <span class="s">x-accept-content-transfer-encoding</span>
        <span class="pi">-</span> <span class="s">x-accept-response-streaming</span>
        <span class="pi">-</span> <span class="s">x-user-agent</span>
        <span class="pi">-</span> <span class="s">x-grpc-web</span>
      <span class="na">maxAge</span><span class="pi">:</span> <span class="s">1728s</span>
      <span class="na">exposeHeaders</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">custom-header-1</span>
        <span class="pi">-</span> <span class="s">grpc-status</span>
        <span class="pi">-</span> <span class="s">grpc-message</span>
      <span class="na">allowCredentials</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Notice that we’ve defined a complex <code class="language-plaintext highlighter-rouge">corsPolicy</code> here, and it’s required for
gRPC-Web to work correctly.</p>

<p>We can now simply deploy the above configurations in the following order.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>kubectl apply <span class="nt">-f</span> filter.yaml
<span class="gp">$</span><span class="w"> </span>kubectl apply <span class="nt">-f</span> &lt;<span class="o">(</span>istioctl kube-inject <span class="nt">-f</span> backend.yaml<span class="o">)</span>
<span class="gp">$</span><span class="w"> </span>kubectl apply <span class="nt">-f</span> gateway.yaml
</code></pre></div></div>

<p>Once the <code class="language-plaintext highlighter-rouge">backend</code> pod has started, we can verify that the gRPC-Web filter was
correctly configured in its sidecar proxy like so:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>istioctl proxy-config listeners backend-7bf6c8f67c-8lbm7 <span class="nt">--port</span> 9000 <span class="nt">-o</span> json
<span class="c">...
</span><span class="go">    "http_filters": [
        {
            "config": {},
            "name": "envoy.grpc_web"
        },
</span><span class="c">...
</span></code></pre></div></div>

<h2 id="deploying-and-testing-the-web-frontend">Deploying And Testing The Web Frontend</h2>

<p>We’ve now reached the final stage of the experiment. We serve the web
application using a HTTP server via Python.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python2 <span class="nt">-m</span> SimpleHTTPServer 8080
<span class="go">Serving HTTP on 0.0.0.0 port 8080 ...
</span></code></pre></div></div>

<p>Let’s head over to <code class="language-plaintext highlighter-rouge">http://localhost:8080</code> to play with the emoji web interface.</p>

<p>If everything went well, you should have a fully functional gRPC-Web based web
application, as shown below.</p>

<p><img src="assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/demo.gif" alt="Demo" /></p>

<p>If you observe the Developer Tools on a browser like Chrome, you should see the
gRPC-Web HTTP requests as shown below.</p>

<p><img src="assets/images/2018-11-10-seamless-cloud-native-apps-with-grpc-web-and-istio/chrome.png" alt="Chrome" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>gRPC-Web provides a great way of bringing the benefits of gRPC services over to
web applications. It currently needs a middle agent like the Istio Data Plane
(i.e. Envoy Proxy) in order to translate data to/from HTTP and gRPC formats.
However, once we have the infrastructure ready, building web applications can
become a seamless experience for developers when working with gRPC.</p>

<h2 id="references">References</h2>

<ul>
  <li>The gRPC-Web <a href="https://github.com/grpc/grpc-web/tree/master/net/grpc/gateway/examples/helloworld">Hello World Guide</a></li>
  <li>The WebpageFx <a href="https://www.webpagefx.com/tools/emoji-cheat-sheet/">Emoji Cheat Sheet</a></li>
</ul>

<hr />

<p>Let me know what you think.</p>

<p><strong>Disclaimer:</strong> My postings are my own and don’t necessarily represent VMware’s positions, strategies or opinions.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/venilnoronha.png" alt="venilnoronha" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name">
                                    
                                        <a href="/about/">Venil Noronha</a>
                                    
                                </h4>
                                
                                    <p>Open Source Enthusiast</p>
                                
                                <p style="margin-top: 2px;">
                                    <a href="https://github.com/venilnoronha" target="_blank" rel="noopener">GitHub</a> |
                                    
                                    <a href="https://twitter.com/venilnoronha" target="_blank" rel="noopener">Twitter</a> |
                                    
                                    <a href="https://linkedin.com/in/venilnoronha" target="_blank" rel="noopener">LinkedIn</a>
                                </p>
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/venilnoronha">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio';
                            this.page.identifier = 'Seamless Cloud-Native Apps with gRPC-Web and Istio';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://venilnoronha-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Venil Noronha &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/distributed-systems/">Distributed systems</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/introduction-to-original-destination-in-envoy">Introduction to Original Destination in Envoy</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/a-beginners-guide-to-authn-and-authz-with-istio">A Beginner's Guide to AuthN and AuthZ with Istio</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/a-simple-state-machine-framework-in-go">A Simple State Machine Framework in Go</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/distributed-systems/">
                                
                                    See all 13 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/hand-crafting-a-sidecar-proxy-and-demystifying-istio">
                <div class="post-card-image" style="background-image: url(/assets/images/2019-03-10-hand-crafting-a-sidecar-proxy-and-demystifying-istio/banner.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/hand-crafting-a-sidecar-proxy-and-demystifying-istio">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Distributed systems</span>
                            
                        
                    

                    <h2 class="post-card-title">Hand-crafting a Sidecar Proxy and Demystifying Istio</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>The sidecar proxy pattern is an important concept that lets [Istio](https://istio.io/) provide routing, metrics, security, and other features to services running in a [service mesh](https://en.wikipedia.org/wiki/Microservices#Service_Mesh). In this post I'll explain key techniques that</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/venilnoronha.png" alt="Venil Noronha" />
                        
                        <span class="post-card-author">
                            
                                <a href="/about/">Venil Noronha</a>
                            
                        </span>
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/envoy-grpc-and-rate-limiting">
                <div class="post-card-image" style="background-image: url(/assets/images/2018-10-27-envoy-grpc-and-rate-limiting/banner.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/envoy-grpc-and-rate-limiting">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Distributed systems</span>
                            
                        
                    

                    <h2 class="post-card-title">Envoy, gRPC, and Rate Limiting</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>Envoy is a lightweight service proxy designed for Cloud Native applications. It’s also one of the few proxies that support gRPC, which is based on the H2 (HTTP/2) protocol. gRPC is a high</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/venilnoronha.png" alt="Venil Noronha" />
                        
                        <span class="post-card-author">
                            
                                <a href="/about/">Venil Noronha</a>
                            
                        </span>
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://venilnoronha.io/">
            
                <img src="/assets/images/favicon.png" alt="Venil Noronha icon" />
            
            <span>Venil Noronha</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Seamless Cloud-Native Apps with gRPC-Web and Istio</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Seamless+Cloud-Native+Apps+with+gRPC-Web+and+Istio&amp;url=https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://venilnoronha.io/seamless-cloud-native-apps-with-grpc-web-and-istio"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://venilnoronha.io/">Venil Noronha</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="https://github.com/venilnoronha" target="_blank" rel="noopener">GitHub</a>
                    
                    <a href="https://twitter.com/venilnoronha" target="_blank" rel="noopener">Twitter</a>
                    
                    <a href="https://linkedin.com/in/venilnoronha" target="_blank" rel="noopener">LinkedIn</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PP90X6NKJH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PP90X6NKJH');
</script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
